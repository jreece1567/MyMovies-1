<html>
<head>
</head>
<script>

window.onload = function(){
	buildKeys("all");
}

function doGet(url,key,callback) {
    var xhr = new XMLHttpRequest();
	var response = "";
    xhr.onreadystatechange = function() {
        if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
            console.log(xhr.responseText);
			response = JSON.parse(xhr.responseText);
			callback(response,key);
        }
    };

    xhr.open('GET', url);
    xhr.send();
}

function formatKeyList(list,key) {
	document.write("<h2>"+key+"</h2>")
	if (key != "all") {
		document.write("<span onclick='buildKeys(\"all\")'>Home</span><br/>");
	}
	document.write("<ul>");
	var ix;
	var sList;
	for (ix = 0; ix < list.length; ix++) {
		if (list[ix] != "all") {
			sList = "";
			if (key == "all") {
				sList = sList + "<li onclick='buildKeys( \"" + list[ix] + "\" )' >";
			} else {
				sList = sList + "<li onclick='buildTitles(\"" + key + "\"" + ", \"" + list[ix] + "\" )' >";
			}
			sList = sList + list[ix];
			sList = sList + "</li>";
			document.write(sList);
		}
	}
	document.write("</ul>")
}

function formatTitleList(list,key) {
	document.write("<h2>"+key+" ("+list.length+")"+"</h2>")
	document.write("<span onclick='buildKeys(\"all\")'>Home</span><br/>");
	document.write("<ul>");
	var ix;
	var sList;
	for (ix = 0; ix < list.length; ix++) {
		sList = "";
		sList = sList + "<li>";
		sList = sList + "(" + list[ix].releaseYear + ") - " + list[ix].title;
		sList = sList + "</li>";
		document.write(sList);
	}
	document.write("</ul>")
}

function buildKeys(key) {
	document.body.innerHTML = "";
	doGet('http://localhost:8080/index/keys/'+key,key,formatKeyList);
}

function buildTitles(key,zname) {
	document.body.innerHTML = "";
	doGet('http://localhost:8080/titles/'+key+'?name='+zname,zname,formatTitleList);
}


</script>

<body>
</body>